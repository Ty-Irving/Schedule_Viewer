<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel = "stylesheet" href = "../CSS/styles.css"/>
    <title>Log In</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body class="bg">

    <div class = "login-panel">
        <div class = "login-header">
            Login
        </div>
        <div class = "input-box">
            <img src = "../HTML/user-img.png" class = "box-img">
            <input type = "text" class = "user-text" maxlength = "30" placeholder = "Username" id = "user"></input>
        </div>
        <div class = "input-box">
            <img src = "../HTML/password-img.png" class = "box-img">
            <input type = "password" class = "user-text" maxlength = "30" placeholder = "Password" id = "pass"></input>
        </div>
        <div class = "create-acc">
            <a href = "create_account.html">Create Account</a>
        </div>
        <button class = "login-button" onclick = "checkLogin()">LOGIN</button>
    </div>
</body>
</html>

<script type = "text/javascript">

window.onload = function() {
    if(!window.location.hash) {
        window.location = window.location + '#loaded';
        window.location.reload();
    }
    }
    
function checkLogin()
    {
        const USER = document.getElementById("user");
        const PASS = document.getElementById("pass");
        var userID;
        var settings = 
        {
            "async": true,
            "crossDomain": true,
            "url": "http://127.0.0.1:8000/API/v1/login/" + USER.value,
            "method": "GET",
        };
        $.ajax(settings).done(function (response){
            localStorage.setItem('user', JSON.stringify(response));
        });
        let userinfo = JSON.parse(localStorage.getItem('user'))

        if(userinfo.Password == PASS.value)
        {
            settings = 
            {
                "async": true,
                "crossDomain": true,
                "url": "http://127.0.0.1:8000/API/v1/users/",
                "method": "GET",
            };
            $.ajax(settings).done(function (response){
                localStorage.setItem('users', JSON.stringify(response));
            });
            let users = JSON.parse(localStorage.getItem('users'))
            console.log(users);
            for(var i = 0; i < users.length; i++)
            {
                if(USER.value == users[i].UserUsername)
                {
                    userID = users[i].UserId;
                    localStorage.setItem("userID", userID);
                }
            }
            getManagers();
            let managerList = JSON.parse(localStorage.getItem('managerList'));
            console.log(managerList + "   " + userID);
            for(var i = 0; i < managerList.length; i++)
            {
                if(parseInt(userID) == parseInt(managerList[i].ManagerID))
                {
                    window.location.href = "builder.html";
                }
            }
            
            if(userID != undefined && Number.IsInteger(managerList.ManagerID))
            {
                window.location.href = "schedule_view.html";
            }
            
            
        }
        
    } 

    function getManagers()
    {
        
        settings = 
            {
                "async": true,
                "crossDomain": true,
                "url": "http://127.0.0.1:8000/API/v1/managers/",
                "method": "GET",
            };
            $.ajax(settings).done(function (response){
                localStorage.setItem('managerList', JSON.stringify(response));
            });
    }
</script>



<style type="text/css">

    /* @media only screen {
        .login-button {
            background-color: red;
        }
    } */


    .user-text {
        resize: none;
        display: block;
        margin-left: auto;
        margin-right: auto;
        width:  230px;
        height: 30px;
        float: right;
        border: none;
        outline: none;
        background-color: whitesmoke;
    }

    .create-acc
    {
        width: 40%;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 10px;
        margin-top: 5px;
        text-align: right;
        font-size: 14px; 
    }

    a
    {
        text-decoration: none;
        color: #04AA6D;
    }


    .login-header
    {
        width: 40%;
        margin-left: auto;
        margin-right: auto;
        font-size: 24px;
        color: #04AA6D;
        font-weight: bold;
        padding-top: 90px;
    }

    .box-img
    {
        width: 25px;
        padding-left: 10px;
        padding-top: 3px;
    }

    .input-box
    {
        margin-top: 25px;
        width: 40%;
        margin-left: auto;
        margin-right: auto;
        border: rgb(49, 46, 46) 1px solid;
        height: 32px;
    }

    .login-button {
        margin-left: auto;
        margin-right: auto;
        display: block;
        width: 40%;
        margin-top: 5%;
        height: 40px;
        border-radius: 8px;
        border-style: double;
        background-color: #04AA6D;
        color: white; 
    }
    
    .login-panel {
        opacity: 88%;
        width: 700px;
        height: 60ex;
        background-color: whitesmoke;
        margin-left: auto;
        margin-right: auto;
        margin-top: 15%;
    }

    .bg {
        position: fixed;
        width: 100%;
        height: 100%;
        background: url("https://bit.ly/3tFgT8c");
        background-position: center;
        background-attachment: fixed;
        background-size: cover;
    }

    /* img
    {
        filter: invert(1);
    } */


</style>